/*
* jQuery plugin that makes elements editable
*
* @author Victor Jonsson (http://victorjonsson.se/)
* @website https://github.com/victorjonsson/jquery-editable/
* @license GPLv2 http://www.gnu.org/licenses/gpl-2.0.html
* @version 1.3.6.dev
* @donations http://victorjonsson.se/donations/
*/
(function(n,t){"use strict";var r=n(t),i=!1,u=!1,e="data-edit-event",o="data-is-editing",f="data-is-empty",h="dbltap",p="ontouchend"in t,w="tinyMCE"in t&&typeof t.tinyMCE.init=="function",b=n.fn.is,c=0,l=function(){var t=(new Date).getTime();t-c<250&&n(this).trigger(h);c=t},a=function(n){if(n.keyCode==13&&n.data.closeOnEnter)u.editable("close");else if(n.data.toggleFontSize&&n.metaKey&&(n.keyCode==38||n.keyCode==40)){var t=parseInt(i.css("font-size"),10);return t+=n.keyCode==40?-1:1,i.css("font-size",t+"px"),!1}},s=function(){i[0].scrollHeight!==parseInt(i.attr("data-scroll"),10)&&(i.css("height",i[0].scrollHeight+"px"),i.attr("data-scroll",i[0].scrollHeight))},v=function(n,t,r){n.removeAttr(o);t.length==0&&r?(n.html(r),n.attr(f,"empty")):(n.html(t),n.removeAttr(f));i.remove()},y=function(t,e){var l;if(!t.is(":editing")){u=t;t.attr(o,"1");t.is(":empty")&&(t.removeAttr(f),t.html(""));var h=n.trim(t.html()),y=t.css("font-size"),p=t.height(),c="width: 96%; padding:0; margin:0; border:0; background:none;font-family: "+t.css("font-family")+"; font-size: "+t.css("font-size")+";font-weight: "+t.css("font-weight")+";";e.lineBreaks&&(h=h.replace(/<br( |)(|\/)>/g,"\n"));i=n("<textarea><\/textarea>");t.text("");navigator.userAgent.match(/webkit/i)!==null&&(c=document.defaultView.getComputedStyle(t.get(0),"").cssText);c+="position: static";e.tinyMCE!==!1?(l="editable-area-"+(new Date).getTime(),i.val(h).appendTo(t).attr("id",l),typeof e.tinyMCE!="object"&&(e.tinyMCE={}),e.tinyMCE.mode="exact",e.tinyMCE.elements=l,e.tinyMCE.width=t.innerWidth(),e.tinyMCE.height=t.height()+200,e.tinyMCE.theme_advanced_resize_vertical=!0,e.tinyMCE.setup=function(f){f.onInit.add(function(f){var s=f.getWin(),c=!1,o=function(){var s=n(f.getDoc()).find("body").html();n(s).get(0).nodeName==t.get(0).nodeName&&(s=n(s).html());v(t,s,e.emptyMessage);f.remove();i=!1;r.unbind("click",o);u=!1;typeof e.callback=="function"&&e.callback({content:s==h||!c?!1:s,fontSize:!1,$el:t})};setTimeout(function(){r.bind("click",o)},500);i=n("<textarea><\/textarea>");i.bind("blur",o);s.onkeydown=function(){c=!0};s.focus()})},tinyMCE.init(e.tinyMCE)):((e.toggleFontSize||e.closeOnEnter)&&r.bind("keydown",e,a),r.bind("keyup",s),i.val(h).blur(function(){u=!1;var f=n.trim(i.val()),o=i.css("font-size");e.lineBreaks&&(f=f.replace(new RegExp("\n","g"),"<br />"));v(t,f,e.emptyMessage);o!=y&&t.css("font-size",o);r.unbind("keydown",a);r.unbind("keyup",s);typeof e.callback=="function"&&e.callback({content:f==h?!1:f,fontSize:o==y?!1:o,$el:t})}).attr("style",c).appendTo(t).css({margin:0,padding:0,height:p+"px",overflow:"hidden"}).css(e.editorStyle).focus().get(0).select(),s());t.trigger("edit",[i])}},k=function(t){return u!==!1?(u.editable("close"),y(n(this),t.data)):y(n(this),t.data),!1};n.fn.editable=function(t){if(typeof t=="string")if(this.is(":editable"))switch(t){case"open":this.is(":editing")||this.trigger(this.attr(e));break;case"close":this.is(":editing")&&i.trigger("blur");break;case"destroy":this.is(":editing")&&i.trigger("blur");this.unbind(this.attr(e));this.removeAttr(e);break;default:console.warn('Unknown command "'+t+'" for jquery.editable')}else console.error("Calling .editable() on an element that is not editable, call .editable() first");else this.is(":editable")&&(console.warn('Making an already editable element editable, call .editable("destroy") first'),this.editable("destroy")),t=n.extend({event:"dblclick",touch:!0,lineBreaks:!0,toggleFontSize:!0,closeOnEnter:!1,emptyMessage:!1,tinyMCE:!1,editorStyle:{}},t),t.tinyMCE===!1||w||(console.warn("Trying to use tinyMCE as editor but id does not seem to be installed"),t.tinyMCE=!1),p&&t.touch?(t.event=h,this.unbind("touchend",l),this.bind("touchend",l)):t.event+=".textEditor",this.bind(t.event,t,k),this.attr(e,t.event),this.html().length==0&&t.emptyMessage?(this.html(t.emptyMessage),this.attr(f,"empty")):this.removeAttr(f);return this};n.fn.is=function(n){if(typeof n=="string"&&n.indexOf(":")===0){if(n==":editable")return this.attr(e)!==undefined;if(n==":editing")return this.attr(o)!==undefined;if(n==":empty")return this.attr(f)!==undefined}return b.apply(this,arguments)}})(jQuery,window);
//# sourceMappingURL=jquery.editable.min.js.map
